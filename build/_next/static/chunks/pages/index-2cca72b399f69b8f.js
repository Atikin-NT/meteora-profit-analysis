(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(3889)}])},3889:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return tS}});var n,s,a=i(5893),o=i(7294),r=i(9174),l=i(8425),d=i(8788),u=i(5340),c=i(7615),_=i(5914),m=i(9493),p=i(1259);async function g(t){return new Promise(e=>setTimeout(e,t))}async function h(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;try{return t()}catch(s){if(i>n)throw Error("Failed to execute ".concat(t.toString()," after ").concat(n," retries"));return await g(e),h(t,2*e,i+1,n)}}class f{get(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new Promise(async t=>{let i=this._stringifyArgs(e);if(this._queueRequest(i,t),!this._fetching.has(i)&&this._requiresRefresh(i)){this._fetching.add(i);let t=await this._fn(...e),n=new Date().getTime();this._responseCache.set(i,{loadTime:n,response:t}),this._fetching.delete(i),this._processQueue(i)}this._processQueue(i)})}_stringifyArgs(t){return Object.values(t).map(t=>{try{return JSON.stringify(t)}catch(t){return""}}).join("")}_requiresRefresh(t){let e=this._responseCache.get(t);return!e||e&&new Date().getTime()-e.loadTime>this._maxAge}_queueRequest(t,e){let i=this._requestQueue.get(t);if(i){i.push(e);return}let n=[e];this._requestQueue.set(t,n)}_processQueue(t){let e=this._requestQueue.get(t);for(e.length>0&&this._fetching.has(t);e.length>0&&!this._fetching.has(t);)e[0](this._responseCache.get(t).response),e.shift()}constructor(t){this._requestQueue=new Map,this._responseCache=new Map,this._fetching=new Set;let{fn:e,throttle:i,maxAge:n}=t;this._fn=i?i(e):e,this._maxAge=n||3e5}}function w(t,e,i){let n=new f({fn:t,throttle:e,maxAge:i});return n.get.bind(n)}function x(t,e){let i=new f({fn:t,maxAge:e});return i.get.bind(i)}function S(t,e){let i=0;return t.forEach(t=>{let n=t[e];"number"!=typeof n||isNaN(n)||(i+=n)}),i}function j(t,e){let i=[];return t.forEach(t=>{let n=t[e];"number"!=typeof n||isNaN(n)||i.push(n)}),Math.max(...i)}function b(t,e){let i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}function y(t,e){b(t,function(t){if(0==t.length)return"";let e=Object.keys(t[0]).join(","),i=[];return t.forEach(t=>{let e=Object.values(t).map(t=>null!=t&&"object"!=typeof t?'"'+t.toString().replace(/"/g,'""')+'"':"").join(",");i.push(e)}),e+"\n"+i.join("\n")}(e))}function v(t){let e=Math.floor(t/1e3),i=Math.floor(e/60);return"".concat(i>0?"".concat(i,"m, "):"").concat(e%60,"s")}let P=(0,u.Z)({limit:Number(p.cn),interval:1e3,strict:!0}),D=w((t,e)=>h(()=>c.ZP.create(t,new _.PublicKey(e))),P);w(async(t,e,i)=>{let n=await D(t,e),{userPositions:s}=await n.getPositionsByUserAndLbPair(new _.PublicKey(i));return{dlmmPool:n,userPositions:s}},P);let F=P(async(t,e,i)=>h(()=>t.getSignaturesForAddress(e,{before:i})));async function N(t,e,i,n){let s;let a=new _.PublicKey(e),o=[],r=[];do s=o.length>0?o[o.length-1].signature:void 0,r.push(...o=await F(t,a,s)),i&&i(o);while(0!=o.length);return n&&n(),r}let L=P(async(t,e)=>h(()=>t.getParsedTransactions(e,{maxSupportedTransactionVersion:0,commitment:"confirmed"}))),A=P(async(t,e)=>h(()=>t.getParsedAccountInfo(new _.PublicKey(e)))),C=P(async(t,e)=>{let i=new m.zw([{idl:c.xO,programId:p.xS}]),n=await i.parseTransaction(t,e,!1);if(void 0==n)return[];let s=n.map(t=>t.accounts).flat().filter(t=>"position"==t.name);return s?Array.from(new Set(s.map(t=>t.pubkey.toBase58()))):[]}),T=(0,u.Z)({limit:2,interval:1e3,strict:!0}),U=(0,u.Z)({limit:4,interval:1e3,strict:!0}),k=T(t=>fetch(p.GH+p.LF+"/"+t)),E=U(t=>fetch(p.GH+p.LF+"/"+t+"/deposits")),O=U(t=>fetch(p.GH+p.LF+"/"+t+"/withdraws"));async function M(t){let e=await k(t);if(500==e.status){console.warn("Position ".concat(t," not found"));return}if(429==e.status){let e="Throttled while loading ".concat(t);throw console.error(e),Error(e)}try{let t=await e.json();return X(t)}catch(e){console.warn("Position ".concat(t," not found")),console.error(e);return}}async function X(t){let[e,i]=await Promise.all([E(t.address),O(t.address)]),[n,s]=await Promise.all([e.json(),i.json()]);return{position:t,deposits:n,withdraws:s}}U(t=>fetch(p.GH+p.LF+"/"+t+"/claim_fees")),U(t=>fetch(p.GH+p.LF+"/"+t+"/claim_rewards"));let q=x(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fetch,e=await t(p.GH+p.Uq),i=JSON.parse(await e.text());return{lastUpdated:new Date().getTime(),pairs:i}});async function G(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fetch;return(await q(e)).pairs.find(e=>e.address==t)}let I=x(async t=>{let e=await fetch(p.o8+t);return(await e.json()).data[t]});(n=s||(s={})).Community="community",n.OldRegistry="old-registry",n.SolanaFm="solana-fm",n.Token2022="token-2022",n.Unknown="unknown",n.Wormhole="wormhole";let H=x(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fetch,e=arguments.length>1?arguments[1]:void 0,i="strict"==e?p.bY:p.G4,n=await t(i),s=JSON.parse(await n.text()),a=new Map;return s.forEach(t=>a.set(t.address,t)),a});async function Q(t,e,i){var n;let s=(await H(fetch,"all")).get(e);if(s)return i/10**s.decimals;let a=await A(t,e);if(!(null==a?void 0:null===(n=a.value)||void 0===n?void 0:n.data)||a.value.data&&!("parsed"in a.value.data))throw Error("".concat(e," is not a valid token address!"));return i/10**a.value.data.parsed.decimals}async function R(t,e,i){let[n,s]=await Promise.all([Q(t,e,i),I(e)]);return n*s.price}async function z(t,e,i){let n=e.lbPosition;if(n){let s=i[i.length-1];s.timestamp_ms_balance_end=new Date().getTime(),s.balance_age_ms=s.timestamp_ms_balance_end-s.timestamp_ms_balance_start;let{mintX:a,mintY:o,reward1Mint:r,reward2Mint:l}=e.mints,[d,u,c,_,m,p]=await Promise.all([R(t,a,Number(n.positionData.totalXAmount)),R(t,o,Number(n.positionData.totalYAmount)),R(t,a,Number(n.positionData.feeX)),R(t,o,Number(n.positionData.feeY)),r?R(t,r,Number(n.positionData.rewardOne)):0,l?R(t,l,Number(n.positionData.rewardOne)):0]);return{current_usd:d+u,unclaimed_fees_usd:c+_,unclaimed_rewards_usd:m+p}}return{current_usd:0,unclaimed_fees_usd:0,unclaimed_rewards_usd:0}}async function B(t,e){let{deposits:i,withdraws:n}=e,s=function(t,e,i){let n=e.length,s=0==e.length?0:e.map(t=>t.token_x_usd_amount+t.token_y_usd_amount).reduce((t,e)=>t+e),a=i.length,o=0==i.length?0:i.map(t=>t.token_x_usd_amount+t.token_y_usd_amount).reduce((t,e)=>t+e),r=[];0==n&&r.push("No deposits found"),0==s&&r.push("Deposits sum to 0 USD"),a>0&&0==o&&r.push("Withdraws sum to 0 USD");let l=Math.max(...e.map(t=>1e3*t.onchain_timestamp).concat(i.map(t=>1e3*t.onchain_timestamp)));return{deposit_count:n,deposits_usd:s,withdraws_count:a,withdraws_usd:o,claimed_fees_usd:t.position.total_fee_usd_claimed,claimed_rewards_usd:t.position.total_reward_usd_claimed,most_recent_deposit_withdraw:l,errors:r}}(e,i,n),a=function(t,e){let i;let n=t.map(t=>({tx_id:t.tx_id,transaction_type:"deposit",timestamp_ms:1e3*t.onchain_timestamp,balance_change_usd:t.token_x_usd_amount+t.token_y_usd_amount})).concat(e.map(t=>({tx_id:t.tx_id,transaction_type:"withdraw",timestamp_ms:1e3*t.onchain_timestamp,balance_change_usd:-t.token_x_usd_amount-t.token_y_usd_amount}))).sort((t,e)=>t.timestamp_ms-e.timestamp_ms),s=[];for(let t=0;t<n.length;t++){let e=n[t],a=t+1<n.length?n[t+1]:null,o={tx_id_balance_start:e.tx_id,tx_id_balance_end:a?a.tx_id:null,timestamp_ms_balance_start:e.timestamp_ms,timestamp_ms_balance_end:a?a.timestamp_ms:e.timestamp_ms,balance_age_ms:0,transaction_type:e.transaction_type,balance_change_usd:e.balance_change_usd,balance_usd:i?i.balance_usd+e.balance_change_usd:e.balance_change_usd};o.balance_age_ms=o.timestamp_ms_balance_end-o.timestamp_ms_balance_start,s.push(o),i=o}return s}(i,n),o=await z(t,e,a),r=function(t,e,i){let{withdraws_usd:n,deposits_usd:s,claimed_fees_usd:a,claimed_rewards_usd:o}=e,{current_usd:r,unclaimed_fees_usd:l,unclaimed_rewards_usd:d}=i,u=0==t.length?0:t.map(t=>t.balance_usd*t.balance_age_ms).reduce((t,e)=>t+e),c=0==t.length?0:t.map(t=>t.balance_age_ms).reduce((t,e)=>t+e),_=c/864e5,m=u/c,p=m*_,g=1e3*(a+l),h=1e3*(o+d),f=n+r-s;return{balance_time_sum_product:u,total_time:c,total_time_days:_,average_balance:m,position_profit:f,total_profit:f+a+o+l+d,balance_points:p,fee_points:g,reward_points:h,total_points:p+g+h}}(a,s,o);return{...e,...s,...o,balances:a,...r}}async function Y(t,e){let i=await M(e);if(!i)return;let n=await G(i.position.pair_address),s=function(t){var e,i;let[n,s]=t.name.split("-"),a=t.name,o="".concat(s,"-").concat(n),r=(e=n,i=s,!["SOL","USDC","USDT"].includes(e)||("SOL"==e?["USDC","USDT"].includes(i):["USDC","USDT"].includes(e)&&["USDC","USDT"].includes(i)&&"USDT"!=e))?a:o;return{name:a,group_name:r,group_id:[t.mint_x,t.mint_y].sort((t,e)=>t<e?0:1).join("")}}(n),a={mintX:n.mint_x,mintY:n.mint_y,reward1Mint:n.reward_mint_x,reward2Mint:n.reward_mint_y};return B(t,{...i,pair_name:s,mints:a})}async function W(t,e,i){let n=[],s=[];for(let a=0;a<t.length;a++){let o=t[a];if(o){let t=function(t){if(!t.transaction.message.instructions.map(t=>t.programId.toBase58()==p.xS).reduce((t,e)=>t||e))return;let e=t.transaction.message.instructions.map(t=>{if(t.accounts)return function(t){if(8!==t.accounts.length)return{positionAddress:void 0,isClosed:!1};let e=t.accounts.map(t=>t.toBase58());return e[0]==e[3]?{positionAddress:e[1],isClosed:!1}:{positionAddress:e[0],isClosed:!0}}(t)}).filter(t=>null==t?void 0:t.positionAddress);if(0!=e.length)return e[0]}(o);if(t){let a=t.positionAddress;!n.includes(a)&&(n.push(a),e&&e(a)),t.isClosed&&!s.includes(a)&&(s.push(a),i&&i(a))}}}return n}async function Z(t,e,i){let n=[],s=[],a=[],o=[],r=0,l=0,d=0,u=!1;if(44==e.length||43==e.length)await N(t,e,async t=>c(t),()=>{u=!0,(null==i?void 0:i.onAllSignaturesFound)&&i.onAllSignaturesFound(),p()});else{let n=await C(t,e);await Promise.all(n.map(e=>{N(t,e,async t=>c(t))})),u=!0,(null==i?void 0:i.onAllSignaturesFound)&&i.onAllSignaturesFound(),p()}function c(t){let e=t.filter(t=>null==t.err);if(e.length>0){let t=e.map(t=>t.signature);n.push(...t),r+=e.length,(null==i?void 0:i.onSignaturesFound)&&i.onSignaturesFound(r),_(t)}}async function _(e){W(await L(t,e),t=>{s.includes(t)||(s.push(t),(null==i?void 0:i.onPositionFound)&&i.onPositionFound(t),m(t))},t=>{a.includes(t)||a.push(t)}),l+=e.length,p()}async function m(e){let n=await Y(t,e);d++,n&&((null==i?void 0:i.onProfitAnalyzed)&&i.onProfitAnalyzed(d,n),o.push(n)),p()}function p(){u&&l==n.length&&(null==i?void 0:i.onAllPositionsFound)&&i.onAllPositionsFound(),u&&l==n.length&&d==s.length&&(o.forEach(t=>{t.is_closed=a.includes(t.position.address),t.is_closed&&0==t.withdraws_count&&t.errors.push("Closed position missing withdraws")}),(null==i?void 0:i.onDone)&&i.onDone())}return o}function J(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return t.sort((t,i)=>e?i.total_profit-t.total_profit:t.total_profit-i.total_profit)}function K(t){let e=new Map;return t.forEach(t=>{let i=t.pair_name.group_id,n=e.get(i);n?t.most_recent_deposit_withdraw>n&&e.set(i,t.most_recent_deposit_withdraw):e.set(i,t.most_recent_deposit_withdraw)}),t.sort((t,i)=>e.get(i.pair_name.group_id)-e.get(t.pair_name.group_id)||i.most_recent_deposit_withdraw-t.most_recent_deposit_withdraw)}var V=i(8384),$=i(3291),tt=i(5632),te=i(3906),ti=i(6789),tn=i(1652);function ts(t,e){return"Total"!=t.name.group_name?"":e?"first"==e?"font-bold text-lg bg-slate-500 text-white rounded-l-lg":"font-bold text-lg bg-slate-500 text-white rounded-r-lg":"font-bold text-lg bg-slate-500 text-white"}let ta=t=>{let[e,i]=(0,o.useState)({column:"total_profit",direction:"descending"});if(0==t.positionLoadingState.userProfit.pair_groups.length)return(0,a.jsx)(a.Fragment,{});let n={name:{group_name:"Total",group_id:"Total"},pair_count:t.positionLoadingState.userProfit.pair_count,position_count:t.positionLoadingState.userProfit.position_count,deposits_usd:t.positionLoadingState.userProfit.deposits_usd,withdraws_usd:t.positionLoadingState.userProfit.withdraws_usd,claimed_fees_usd:t.positionLoadingState.userProfit.claimed_fees_usd,claimed_rewards_usd:t.positionLoadingState.userProfit.claimed_rewards_usd,average_balance:t.positionLoadingState.userProfit.balance_time_sum_product/t.positionLoadingState.userProfit.total_time,total_profit:t.positionLoadingState.userProfit.total_profit};return(0,a.jsx)("div",{className:"w-full pl-4 pr-4",children:(0,a.jsxs)(V.b,{sortDescriptor:e,onSortChange:t=>i(t),children:[(0,a.jsxs)($.J,{children:[(0,a.jsx)(tt.j,{allowsSorting:!0,children:"Pair"},"name"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["# of ",(0,a.jsx)("br",{}),"Markets"]},"pair_count"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["# of ",(0,a.jsx)("br",{}),"Positions"]},"position_count"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Fees & ",(0,a.jsx)("br",{}),"Rewards"]},"fees_rewards"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Total ",(0,a.jsx)("br",{}),"Deposits"]},"deposits_usd"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Total ",(0,a.jsx)("br",{}),"Withdrawals"]},"withdraws_usd"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Total ",(0,a.jsx)("br",{}),"Profit"]},"total_profit"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Average ",(0,a.jsx)("br",{}),"Balance"]},"average_balance"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Average Balance ",(0,a.jsx)("br",{}),"Profit %"]},"avg_balance_profit_percent"),(0,a.jsxs)(tt.j,{allowsSorting:!0,children:["Deposits ",(0,a.jsx)("br",{}),"Profit %"]},"deposits_profit_percent")]}),(0,a.jsx)(te.y,{items:[...t.positionLoadingState.userProfit.pair_groups.sort((t,i)=>{switch(e.column){case"fees_rewards":return"descending"==e.direction?i.claimed_fees_usd+i.claimed_rewards_usd-t.claimed_fees_usd-t.claimed_rewards_usd:t.claimed_fees_usd+t.claimed_rewards_usd-i.claimed_fees_usd-i.claimed_rewards_usd;case"avg_balance_profit_percent":let n=t.total_profit/t.average_balance,s=i.total_profit/i.average_balance;return"descending"==e.direction?s-n:n-s;case"deposits_profit_percent":let a=t.total_profit/t.deposits_usd,o=i.total_profit/i.deposits_usd;return"descending"==e.direction?o-a:a-o;case"position_count":case"total_profit":case"average_balance":case"deposits_usd":case"withdraws_usd":return"descending"==e.direction?i[e.column]-t[e.column]:t[e.column]-i[e.column];case"name":return"ascending"==e.direction?t.name.group_name.localeCompare(i.name.group_name):i.name.group_name.localeCompare(t.name.group_name);default:return 0}}),n],children:t=>(0,a.jsxs)(ti.g,{children:[(0,a.jsx)(tn.X,{className:ts(t,"first"),children:t.name.group_name}),(0,a.jsx)(tn.X,{className:ts(t),children:t.pair_count.toLocaleString("en-US")}),(0,a.jsx)(tn.X,{className:ts(t),children:t.position_count.toLocaleString("en-US")}),(0,a.jsx)(tn.X,{className:ts(t),children:(t.claimed_fees_usd+t.claimed_rewards_usd).toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2})}),(0,a.jsx)(tn.X,{className:ts(t),children:t.deposits_usd.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2})}),(0,a.jsx)(tn.X,{className:ts(t),children:t.withdraws_usd.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2})}),(0,a.jsx)(tn.X,{className:ts(t),children:t.total_profit.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2})}),(0,a.jsx)(tn.X,{className:ts(t),children:t.average_balance.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2})}),(0,a.jsx)(tn.X,{className:ts(t),children:(t.total_profit/t.average_balance).toLocaleString("en-US",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2})}),(0,a.jsx)(tn.X,{className:ts(t,"last"),children:(t.total_profit/t.deposits_usd).toLocaleString("en-US",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2})})]},t.name.group_id)})]})})};var to=i(6296),tr=i(9314),tl=i(6032),td=i(4863);let tu=t=>(0,a.jsxs)("div",{className:"flex columns-2 w-full",children:[(0,a.jsxs)("div",{className:"text-nowrap",children:[t.loading?(0,a.jsx)(td.c,{size:"sm"}):!1===t.loading?"✅":"","\xa0",(0,a.jsxs)("b",{children:[t.title,": \xa0"]})]}),(0,a.jsx)("div",{className:"ml-auto",children:"number"==typeof t.value?t.value.toLocaleString("en-us",{minimumFractionDigits:0,maximumFractionDigits:0}):t.value})]});var tc=i(7820),t_=i(6258);let tm=t=>{if(0==t.profits.length)return(0,a.jsx)(a.Fragment,{});let e=t.profits.map(t=>t.position.address),i=t.positionAddresses.filter(t=>!e.includes(t));if(0==i.length)return(0,a.jsx)(a.Fragment,{});let n=()=>{b("missing-transactions.csv","tx_id\n"+i.join("\n"))};return(0,a.jsx)(tc.A,{"aria-label":"Download Missing Transactions",className:"m-4",color:"primary",startContent:(0,a.jsx)(t_._8,{}),onClick:()=>n(),children:"Download Missing Transactions"})},tp=t=>{if(0==t.profits.length)return(0,a.jsx)(a.Fragment,{});let e=()=>{y("dlmm-all-position-summary.csv",K(t.profits).map(t=>{let{position:e,pair_name:i,deposits:n,withdraws:s,deposits_usd:a,withdraws_usd:o,average_balance:r,claimed_fees_usd:l,claimed_rewards_usd:d,total_time_days:u,fee_points:c,reward_points:_,balance_points:m,position_profit:p,total_profit:g,errors:h,total_time:f,balance_time_sum_product:w}=t,x=0==n.length?null:n.sort((t,e)=>t.onchain_timestamp-e.onchain_timestamp)[0],S=0==s.length?null:s.sort((t,e)=>t.onchain_timestamp-e.onchain_timestamp)[0];return{position_address:e.address,pair_address:e.pair_address,pair_name:i.name,pair_group:i.group_name,errors:h.join(" | "),first_deposit_tx_id:x?x.tx_id:null,first_deposit_onchain_timestamp:x?x.onchain_timestamp:null,last_withdraw_tx_id:S?S.tx_id:null,last_withdraw_onchain_timestamp:S?S.onchain_timestamp:null,deposits_usd:a,withdraws_usd:o,average_balance:r,claimed_fees_usd:l,claimed_rewards_usd:d,total_time_days:u,fee_points:c,reward_points:_,balance_points:m,position_profit:p,total_profit:g,total_time:f,balance_time_sum_product:w}}).map(t=>(t.first_deposit_onchain_timestamp=null==t.first_deposit_onchain_timestamp?null:new Date(1e3*Number(t.first_deposit_onchain_timestamp)).toISOString(),t.last_withdraw_onchain_timestamp=null==t.last_withdraw_onchain_timestamp?null:new Date(1e3*Number(t.last_withdraw_onchain_timestamp)).toISOString(),t)))};return(0,a.jsx)(tc.A,{"aria-label":"Download All Positions",className:"m-4",color:"primary",startContent:(0,a.jsx)(t_._8,{}),onClick:()=>e(),children:"Download All Positions"})},tg=t=>{let e=t.profits.filter(t=>0==t.errors.length);if(0==e.length||e.length==t.profits.length)return(0,a.jsx)(a.Fragment,{});let i=()=>{y("dlmm-valid-position-summary.csv",K(e).map(t=>{let{position:e,pair_name:i,deposits:n,withdraws:s,deposits_usd:a,withdraws_usd:o,average_balance:r,claimed_fees_usd:l,claimed_rewards_usd:d,total_time_days:u,fee_points:c,reward_points:_,balance_points:m,position_profit:p,total_profit:g,errors:h,total_time:f,balance_time_sum_product:w}=t,x=0==n.length?null:n.sort((t,e)=>t.onchain_timestamp-e.onchain_timestamp)[0],S=0==s.length?null:s.sort((t,e)=>t.onchain_timestamp-e.onchain_timestamp)[0];return{position_address:e.address,pair_address:e.pair_address,pair_name:i.name,pair_group:i.group_name,errors:h.join(" | "),first_deposit_tx_id:x?x.tx_id:null,first_deposit_onchain_timestamp:x?x.onchain_timestamp:null,last_withdraw_tx_id:S?S.tx_id:null,last_withdraw_onchain_timestamp:S?S.onchain_timestamp:null,deposits_usd:a,withdraws_usd:o,average_balance:r,claimed_fees_usd:l,claimed_rewards_usd:d,total_time_days:u,fee_points:c,reward_points:_,balance_points:m,position_profit:p,total_profit:g,total_time:f,balance_time_sum_product:w}}).map(t=>(t.first_deposit_onchain_timestamp=null==t.first_deposit_onchain_timestamp?null:new Date(1e3*Number(t.first_deposit_onchain_timestamp)).toISOString(),t.last_withdraw_onchain_timestamp=null==t.last_withdraw_onchain_timestamp?null:new Date(1e3*Number(t.last_withdraw_onchain_timestamp)).toISOString(),t)))};return(0,a.jsx)(tc.A,{"aria-label":"Download Valid Positions",className:"m-4",color:"primary",startContent:(0,a.jsx)(t_._8,{}),onClick:()=>i(),children:"Download Valid Positions"})},th=t=>(0,a.jsxs)("div",{className:"flex w-full",children:[(0,a.jsx)(to.w,{className:"m-4 h-fit w-1/2",children:(0,a.jsxs)(tr.G,{children:[(0,a.jsx)(tu,{title:"Time Elapsed",value:t.positionLoadingState.durationString}),t.loading&&t.positionLoadingState.eta&&""!=t.positionLoadingState.eta?(0,a.jsx)(tu,{title:"Estimated time to complete",value:t.positionLoadingState.eta}):"",(0,a.jsx)(tu,{loading:!t.positionLoadingState.allSignaturesFound,title:"# of Transactions Found",value:t.positionLoadingState.signatureCount}),(0,a.jsx)(tu,{loading:!t.positionLoadingState.allPositionsFound,title:"# of Positions Found",value:t.positionLoadingState.positionAddresses.length}),(0,a.jsx)(tu,{loading:t.loading,title:"# of Positions w/ Errors",value:t.positionLoadingState.profits.filter(t=>t.errors.length>0).length}),(0,a.jsx)(tu,{loading:t.loading,title:"# of Positions Analyzed",value:t.positionLoadingState.profits.length}),t.positionLoadingState.done?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(tl.W,{className:"mt-4",isIndeterminate:!t.positionLoadingState.allPositionsFound,showValueLabel:t.positionLoadingState.allPositionsFound,value:t.positionLoadingState.positionProgress})]})}),(0,a.jsxs)("div",{className:"flex w-full justify-end items-end",children:[(0,a.jsx)(tm,{positionAddresses:t.positionLoadingState.positionAddresses,profits:t.positionLoadingState.profits}),(0,a.jsx)(tg,{profits:t.positionLoadingState.profits}),(0,a.jsx)(tp,{profits:t.positionLoadingState.profits})]})]}),tf=t=>0==t.positionLoadingState.startTime?(0,a.jsx)(a.Fragment,{}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(th,{loading:t.loading,positionLoadingState:t.positionLoadingState})}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(ta,{positionLoadingState:t.positionLoadingState})})]});var tw=i(695);let tx=t=>t.loading?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)("div",{className:"flex w-1/2 flex-col gap-4",children:(0,a.jsxs)("div",{className:"flex w-full flex-wrap md:flex-nowrap mb-6 md:mb-0 gap-4",children:[(0,a.jsx)(tw.Y,{disabled:t.loading,label:"Wallet Address or Transaction Signature",type:"text",onChange:e=>t.onChange(e)}),(0,a.jsx)(tc.A,{"aria-label":"Go",color:"primary",disabled:t.loading||!t.appState.connection,onClick:t.loadTransactions,children:"Go"})]})});function tS(){let t={startTime:0,durationString:"",signatureCount:0,allSignaturesFound:!1,allPositionsFound:!1,addressCheckCount:0,profits:[],userProfit:{pair_groups:[],pair_group_count:0,pair_count:0,position_count:0,deposit_count:0,deposits_usd:0,withdraws_count:0,withdraws_usd:0,claimed_fees_usd:0,claimed_rewards_usd:0,most_recent_deposit_withdraw:0,current_usd:0,unclaimed_fees_usd:0,unclaimed_rewards_usd:0,balance_time_sum_product:0,total_time:0,total_time_days:0,average_balance:0,position_profit:0,total_profit:0,fee_points:0,reward_points:0,balance_points:0,total_points:0},checkPoints:[],positionProgress:-1,eta:"",positionAddresses:[],closedPositionAddresses:[],done:!1},e=(0,o.useContext)(r.AppState),[i,n]=(0,o.useState)(""),[s,u]=(0,o.useState)(!1),[c,_]=(0,o.useState)(t);function m(t){if(t.durationString=v(new Date().getTime()-t.startTime),!t.allPositionsFound)return t;let{addressCheckCount:e,positionAddresses:i,checkPoints:n}=t,s=e/i.length;t.positionProgress=Math.round(100*s);let a=0==n.length?new Date().getTime():n[n.length-1].time;if((0==n.length||new Date().getTime()-a>500)&&n.push({pctComplete:s,time:new Date().getTime()}),s<.1||n.length<60)return t.eta="Calculating...",t;let o=n[0],r=n[n.length-1],l=r.time-o.time,d=r.pctComplete-o.pctComplete;return t.eta=v(l/d-l),t.positionProgress=Math.round(100*r.pctComplete),t}async function p(){e.connection&&(u(!0),_(()=>({...t,startTime:new Date().getTime()})),Z(e.connection,i,{onSignaturesFound(t){_(e=>m({...e,signatureCount:t}))},onAllSignaturesFound(){_(t=>m({...t,allSignaturesFound:!0}))},onPositionFound(t){_(e=>e.positionAddresses.includes(t)?e:(e.positionAddresses.push(t),m(e)))},onClosedPositionFound(t){_(e=>e.closedPositionAddresses.includes(t)?e:(e.closedPositionAddresses.push(t),m(e)))},onAllPositionsFound(){_(t=>m({...t,allPositionsFound:!0}))},onProfitAnalyzed(t,e){_(i=>{let n=J([...i.profits,e]),s=function(t){let e=function(t){let e=function(t){let e=[];return Array.from(new Set(t.map(t=>t.position.pair_address))).forEach(i=>{let n=t.filter(t=>t.position.pair_address==i),s=n.filter(t=>0==t.errors.length),a=n.filter(t=>t.errors.length>0),o=S(s,"balance_time_sum_product"),r=S(s,"total_time");e.push({name:n[0].pair_name,pair_address:n[0].position.pair_address,position_count:n.length,positions:s,positionsWithErrors:a,deposit_count:S(s,"deposit_count"),deposits_usd:S(s,"deposits_usd"),withdraws_count:S(s,"withdraws_count"),withdraws_usd:S(s,"withdraws_usd"),claimed_fees_usd:S(n,"claimed_fees_usd"),claimed_rewards_usd:S(n,"claimed_rewards_usd"),most_recent_deposit_withdraw:j(n,"most_recent_deposit_withdraw"),balance_time_sum_product:o,total_time:r,total_time_days:S(s,"total_time_days"),average_balance:o/r,current_usd:S(s,"current_usd"),unclaimed_fees_usd:S(s,"unclaimed_fees_usd"),unclaimed_rewards_usd:S(s,"unclaimed_rewards_usd"),position_profit:S(s,"position_profit"),total_profit:S(s,"total_profit"),fee_points:S(n,"fee_points"),reward_points:S(n,"reward_points"),balance_points:S(s,"balance_points"),total_points:S(n,"total_points")})}),e}(t),i=[];return Array.from(new Set(e.map(t=>t.name.group_id))).forEach(t=>{let n=e.filter(e=>e.name.group_id==t),s=S(n,"balance_time_sum_product"),a=S(n,"total_time");i.push({name:n[0].name,position_groups:n,pair_count:n.length,position_count:S(n,"position_count"),deposit_count:S(n,"deposit_count"),deposits_usd:S(n,"deposits_usd"),withdraws_count:S(n,"withdraws_count"),withdraws_usd:S(n,"withdraws_usd"),claimed_fees_usd:S(n,"claimed_fees_usd"),claimed_rewards_usd:S(n,"claimed_rewards_usd"),most_recent_deposit_withdraw:j(n,"most_recent_deposit_withdraw"),balance_time_sum_product:s,total_time:a,total_time_days:S(n,"total_time_days"),average_balance:s/a,current_usd:S(n,"current_usd"),unclaimed_fees_usd:S(n,"unclaimed_fees_usd"),unclaimed_rewards_usd:S(n,"unclaimed_rewards_usd"),position_profit:S(n,"position_profit"),total_profit:S(n,"total_profit"),fee_points:S(n,"fee_points"),reward_points:S(n,"reward_points"),balance_points:S(n,"balance_points"),total_points:S(n,"total_points")})}),i}(t),i=S(e,"balance_time_sum_product"),n=S(e,"total_time");return{pair_groups:e,pair_group_count:S(e,"position_groups"),pair_count:S(e,"pair_count"),position_count:S(e,"position_count"),deposit_count:S(e,"deposit_count"),deposits_usd:S(e,"deposits_usd"),withdraws_count:S(e,"withdraws_count"),withdraws_usd:S(e,"withdraws_usd"),claimed_fees_usd:S(e,"claimed_fees_usd"),claimed_rewards_usd:S(e,"claimed_rewards_usd"),most_recent_deposit_withdraw:j(e,"most_recent_deposit_withdraw"),balance_time_sum_product:i,total_time:n,total_time_days:S(e,"total_time_days"),average_balance:i/n,current_usd:S(e,"current_usd"),unclaimed_fees_usd:S(e,"unclaimed_fees_usd"),unclaimed_rewards_usd:S(e,"unclaimed_rewards_usd"),position_profit:S(e,"position_profit"),total_profit:S(e,"total_profit"),fee_points:S(e,"fee_points"),reward_points:S(e,"reward_points"),balance_points:S(e,"balance_points"),total_points:S(e,"total_points")}}(n);return s.pair_groups=J(s.pair_groups),m({...i,addressCheckCount:t,profits:n,userProfit:s})})},onDone(){u(!1),_(t=>({...t,done:!0}))}}))}return(0,a.jsx)(d.Z,{children:(0,a.jsxs)("section",{className:"flex flex-col items-center justify-center gap-4 py-8 md:py-10",children:[(0,a.jsxs)("div",{className:"inline-block max-w-lg text-center justify-center",children:[(0,a.jsx)("h1",{className:(0,l.T)(),children:"Meteora Profit Analysis"}),(0,a.jsx)("h4",{className:(0,l.O)({class:"mt-4"}),children:"Find out How Much You’re Printing"})]}),(0,a.jsx)("div",{className:"flex gap-3"}),(0,a.jsx)(tx,{appState:e,loadTransactions:p,loading:s,onChange:t=>n(t.target.value)}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(tf,{loading:s,positionLoadingState:c})})]})})}}},function(t){t.O(0,[655,237,324,861,437,227,125,888,774,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);
//# sourceMappingURL=index-2cca72b399f69b8f.js.map